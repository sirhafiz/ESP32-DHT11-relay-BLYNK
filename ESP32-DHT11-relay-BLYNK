#define BLYNK_TEMPLATE_ID "TEMPLATE_ID"
#define BLYNK_TEMPLATE_NAME "TEMPLATE_NAM"
#define BLYNK_AUTH_TOKEN "AUTH_TOKEN"

#include <WiFi.h>
#include <BlynkSimpleEsp32.h>
#include <DHT.h>

#define DHTPIN 4
#define DHTTYPE DHT11
#define RELAY_PIN 18

char ssid[] = "wifi name";
char pass[] = "password wifi";

DHT dht(DHTPIN, DHTTYPE);


void setup() {
  Serial.begin(115200);
  delay(1000);
  Serial.println("ESP32 + DHT11 + Relay AUTO + Blynk Siap!");

  dht.begin();
  pinMode(RELAY_PIN, OUTPUT);
  digitalWrite(RELAY_PIN, HIGH);  // Mula OFF (active LOW relay)

  Blynk.begin(BLYNK_AUTH_TOKEN, ssid, pass);
  Serial.println("Sedang sambung ke Blynk...");
}

void loop() {
  Blynk.run();

  float suhu = dht.readTemperature();
  float kelembapan = dht.readHumidity();

  if (isnan(suhu) || isnan(kelembapan)) {
    Serial.println("Gagal baca DHT11! Semak wiring/sensor.");
  } else { 
  Serial.print("Suhu: ");
  Serial.print(suhu);
  Serial.print(" Â°C | Kelembapan: ");
  Serial.print(kelembapan);
  Serial.print(" % | Relay: ");
  Serial.println(digitalRead(RELAY_PIN) == LOW ? "ON" : "OFF");
  }

  // Hantar data ke Blynk (monitor je)
  Blynk.virtualWrite(V0, suhu);       // tgk Gauge suhu
  Blynk.virtualWrite(V1, kelembapan); // tgk Gauge kelembapan

  // Auto control relay ikut suhu
  if (suhu > 40) {
    digitalWrite(RELAY_PIN, LOW);     // Relay ON (active LOW)
    Serial.println("SUHU TINGGI! Relay ON");
  } else {
    digitalWrite(RELAY_PIN, HIGH);    // Relay OFF
    Serial.println("Suhu normal, Relay OFF");
  }

   delay(2000);  // Update setiap 2 saat
}
